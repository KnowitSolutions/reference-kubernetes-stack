apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana
  namespace: monitoring
  labels:
    app: grafana
data:
  grafana.ini: |
    [server]
    domain = grafana.krsdev.local
    root_url = http://grafana.krsdev.local

    [auth]
    oauth_auto_login = true
    signout_redirect_url = http://sso.krsdev.local/auth/realms/master/protocol/openid-connect/logout?redirect_uri=http%3A%2F%2Fgrafana.krsdev.local

    [auth.generic_oauth]
    enabled = true
    client_id = grafana
    client_secret = secret
    auth_url = http://sso.krsdev.local/auth/realms/master/protocol/openid-connect/auth
    token_url = http://keycloak.login:8080/auth/realms/master/protocol/openid-connect/token
    api_url = http://keycloak.login:8080/auth/realms/master/protocol/openid-connect/userinfo
    role_attribute_path = contains(roles, 'admin') && 'Admin' || 'Viewer'
